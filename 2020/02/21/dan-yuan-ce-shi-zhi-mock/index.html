<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="单元测试之Mock, 空白格的博客">
    <meta name="description" content="单元测试之Mock1-Mock详解1.1-什么是Mock？mock是在测试过程中，对于一些不容易构造/获取的对象，创建一个mock对象来模拟对象的行为。比如说你需要调用B服务，可是B服务还没有开发完成，那么你就可以将调用B服务的那部分给Mo">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>单元测试之Mock | 空白格的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="空白格的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">空白格的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">空白格的博客</div>
        <div class="logo-desc">
            
            个人技术博客：主要是一些技术杂谈和学习笔记的分享
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/fangpeng12" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #36b3ec;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/fangpeng12" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        单元测试之Mock
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">
                                <span class="chip bg-color">单元测试</span>
                            </a>
                        
                            <a href="/tags/Mock/">
                                <span class="chip bg-color">Mock</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-category">
                                单元测试
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-21
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    43 分
                </div>
                
				
                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="单元测试之Mock"><a href="#单元测试之Mock" class="headerlink" title="单元测试之Mock"></a>单元测试之Mock</h1><h2 id="1-Mock详解"><a href="#1-Mock详解" class="headerlink" title="1-Mock详解"></a>1-Mock详解</h2><h3 id="1-1-什么是Mock？"><a href="#1-1-什么是Mock？" class="headerlink" title="1.1-什么是Mock？"></a>1.1-什么是Mock？</h3><p>mock是在测试过程中，对于一些不容易构造/获取的对象，创建一个mock对象来模拟对象的行为。比如说你需要调用B服务，可是B服务还没有开发完成，那么你就可以将调用B服务的那部分给Mock掉，并编写你想要的返回结果。 Mock有很多的实现框架，例如Mockito、EasyMock、Jmockit、PowerMock、Spock等等，SpringBoot默认的Mock框架是Mockito，和junit一样，只需要依赖spring-boot-starter-test就可以了。</p>
<p><code>Mock</code> 的中文译为仿制的，模拟的，虚假的。对于测试框架来说，即构造出一个模拟/虚假的对象，使我们的测试能顺利进行下去。</p>
<p><code>Mock</code> 测试就是在测试过程中，对于某些 <strong>不容易构造</strong>（如 <code>HttpServletRequest</code> 必须在 <code>Servlet</code> 容器中才能构造出来）或者不容易获取 <strong>比较复杂</strong> 的对象（如 <code>JDBC</code> 中的 <code>ResultSet</code> 对象），用一个 <strong>虚拟</strong> 的对象（<code>Mock</code> 对象）来创建，以便测试方法。</p>
<h3 id="1-2-为什么使用Mock对象？"><a href="#1-2-为什么使用Mock对象？" class="headerlink" title="1.2-为什么使用Mock对象？"></a>1.2-为什么使用Mock对象？</h3><p>使用模拟对象，可以模拟复杂的、真实的对象行为。如果在单元测试中无法使用真实对象，可采用模拟对象进行替代。</p>
<p><strong>在以下情况可以采用模拟对象来替代真实对象：</strong></p>
<ul>
<li>真实对象的行为是不确定的（例如，当前的时间或温度）；</li>
<li>真实对象很难搭建起来；</li>
<li>真实对象的行为很难触发（例如，网络错误）；</li>
<li>真实对象速度很慢（例如，一个完整的数据库，在测试之前可能需要初始化）；</li>
<li>真实的对象是用户界面，或包括用户界面在内；</li>
<li>真实的对象使用了回调机制；</li>
<li>真实对象可能还不存在；</li>
<li>真实对象可能包含不能用作测试（而不是为实际工作）的信息和方法。</li>
</ul>
<p><strong>单元测试</strong> 是为了验证我们的代码运行正确性，我们注重的是代码的流程以及结果的正确与否。</p>
<p>对比真实运行代码，可能其中有一些 <strong>外部依赖</strong> 的构建步骤相对麻烦，如果我们还是按照真实代码的构建规则构造出外部依赖，会大大增加单元测试的工作，代码也会参杂太多非测试部分的内容，测试用例显得复杂难懂。</p>
<p>采用 <code>Mock</code> 框架，我们可以 <strong>虚拟</strong> 出一个 <strong>外部依赖</strong>，只注重代码的 <strong>流程与结果</strong>，真正地实现测试目的。</p>
<h3 id="1-3-Mock测试框架的好处"><a href="#1-3-Mock测试框架的好处" class="headerlink" title="1.3-Mock测试框架的好处"></a>1.3-Mock测试框架的好处</h3><ol>
<li>可以很简单的虚拟出一个复杂对象（比如虚拟出一个接口的实现类）；</li>
<li>可以配置 <code>mock</code> 对象的行为；</li>
<li>可以使测试用例只注重测试流程与结果；</li>
<li>减少外部类、系统和依赖给单元测试带来的耦合。</li>
</ol>
<h3 id="1-4-Spring-Boot的测试类库"><a href="#1-4-Spring-Boot的测试类库" class="headerlink" title="1.4-Spring Boot的测试类库"></a>1.4-Spring Boot的测试类库</h3><p>现在绝大多数的java服务都是Spring框架搭建的，并且也会使用到Spring boot来进行快速搭建开发，在Spring Boot提供了许多实用工具和注解来帮助测试应用程序，主要包括以下两个模块：</p>
<ul>
<li>spring-boot-test：支持测试的核心内容。</li>
<li>spring-boot-test-autoconfigure：支持测试的自动化配置。</li>
</ul>
<p>开发进行只要使用 spring-boot-starter-test 启动器就能引入这些 Spring Boot 测试模块，还能引入一些像 JUnit, AssertJ, Hamcrest 及其他一些有用的类库，具体如下所示：</p>
<ul>
<li>JUnit：Java 应用程序单元测试标准类库。</li>
<li>Spring Test &amp; Spring Boot Test：Spring Boot 应用程序功能集成化测试支持。</li>
<li>AssertJ：一个轻量级的断言类库。</li>
<li>Mockito：一个Java Mock测试框架，默认支付 1.x，可以修改为 2.x。</li>
<li>JsonPath：一个JSON操作类库。</li>
</ul>
<h3 id="1-5-MockMvc"><a href="#1-5-MockMvc" class="headerlink" title="1.5-MockMvc"></a>1.5-MockMvc</h3><p><code>MockMvc</code>是由spring-test包提供，实现了对Http请求的模拟，能够直接使用网络的形式，转换到Controller的调用，使得测试速度快、不依赖网络环境。同时提供了一套验证的工具，结果的验证十分方便。</p>
<p><strong>接口<code>MockMvcBuilder</code>，提供一个唯一的<code>build</code>方法，用来构造MockMvc。</strong></p>
<p>主要有两个实现：<code>StandaloneMockMvcBuilder</code>和<code>DefaultMockMvcBuilder</code>，分别对应两种测试方式，即独立安装和集成Web环境测试（并不会集成真正的web环境，而是通过相应的Mock API进行模拟测试，无须启动服务器）。MockMvcBuilders提供了对应的创建方法standaloneSetup方法和webAppContextSetup方法，在使用时直接调用即可。</p>
<h3 id="1-6-MockMvc测试用例"><a href="#1-6-MockMvc测试用例" class="headerlink" title="1.6-MockMvc测试用例"></a>1.6-MockMvc测试用例</h3><h4 id="1-6-1-引入pom依赖"><a href="#1-6-1-引入pom依赖" class="headerlink" title="1.6.1. 引入pom依赖"></a>1.6.1. 引入pom依赖</h4><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
<h4 id="1-6-2-MockMVC基于RESTful风格的测试"><a href="#1-6-2-MockMVC基于RESTful风格的测试" class="headerlink" title="1.6.2. MockMVC基于RESTful风格的测试"></a>1.6.2. MockMVC基于RESTful风格的测试</h4><blockquote>
<p>对于前后端分离的项目而言，无法直接从前端静态代码中测试接口的正确性，因此可以通过MockMVC来模拟HTTP请求。基于RESTful风格的SpringMVC的测试，我们可以测试完整的Spring MVC流程，即从URL请求到控制器处理，再到视图渲染都可以测试。</p>
</blockquote>
<ul>
<li><p>request</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebRequest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String mobile<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>response</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebResponse</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String code<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String message<span class="token punctuation">;</span>

    <span class="token keyword">private</span> T body<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>写一个简单的Controller</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/web"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/create"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> WebResponse<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> WebRequest webRequest<span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        WebResponse<span class="token operator">&lt;</span>String<span class="token operator">></span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebResponse</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token string">"create 完成---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"00000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>创建一个测试用例</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebControllerIT</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> WebApplicationContext mac<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> MockMvc mockMvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//请求的json</span>
        String json <span class="token operator">=</span> <span class="token string">"{\"name\":\"王五\",\"mobile\":\"12345678901\"}"</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//perform,执行一个RequestBuilders请求，会自动执行SpringMVC的流程并映射到相应的控制器执行处理</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>MockMvcRequestBuilders
                <span class="token comment" spellcheck="true">//构造一个post请求</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/web/create"</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//json类型</span>
                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span>APPLICATION_JSON_UTF8<span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//使用writeValueAsString()方法来获取对象的JSON字符串表示</span>
                <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//andExpect，添加ResultMathcers验证规则，验证控制器执行完成后结果是否正确，【这是一个断言】</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//使用jsonPaht验证返回的json中code字段的返回值</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.code"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"00000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.message"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//body属性不为空</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//添加ResultHandler结果处理器，比如调试时 打印结果(print方法)到控制台</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span>MockMvcResultHandlers<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//返回相应的MvcResult</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<h4 id="1-6-3-常用API"><a href="#1-6-3-常用API" class="headerlink" title="1.6.3-常用API"></a>1.6.3-常用API</h4><ul>
<li><p><strong>常用的期望</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//使用jsonPaht验证返回的json中code、message字段的返回值</span>
<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.code"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"00000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.message"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//body属性不为空</span>
<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 期望的返回结果集合有2个元素 ， $: 返回结果</span>
<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.length()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p><strong>常用API解释</strong></p>
<ul>
<li><p><strong>RequestBuilder/MockMvcRequestBuilders</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//根据uri模板和uri变量值得到一个GET请求方式的MockHttpServletRequestBuilder；</span>
MockHttpServletRequestBuilder <span class="token function">get</span><span class="token punctuation">(</span>String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//同get类似，但是是POST方法；</span>
MockHttpServletRequestBuilder <span class="token function">post</span><span class="token punctuation">(</span>String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//同get类似，但是是PUT方法；</span>
MockHttpServletRequestBuilder <span class="token function">put</span><span class="token punctuation">(</span>String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//同get类似，但是是DELETE方法；</span>
MockHttpServletRequestBuilder <span class="token function">delete</span><span class="token punctuation">(</span>String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//同get类似，但是是OPTIONS方法；</span>
MockHttpServletRequestBuilder <span class="token function">options</span><span class="token punctuation">(</span>String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//提供自己的Http请求方法及uri模板和uri变量，如上API都是委托给这个API；</span>
MockHttpServletRequestBuilder <span class="token function">request</span><span class="token punctuation">(</span>HttpMethod httpMethod<span class="token punctuation">,</span> String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//提供文件上传方式的请求，得到MockMultipartHttpServletRequestBuilder；</span>
MockMultipartHttpServletRequestBuilder <span class="token function">fileUpload</span><span class="token punctuation">(</span>String urlTemplate<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> urlVariables<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//创建一个从启动异步处理的请求的MvcResult进行异步分派的RequestBuilder；</span>
RequestBuilder <span class="token function">asyncDispatch</span><span class="token punctuation">(</span><span class="token keyword">final</span> MvcResult mvcResult<span class="token punctuation">)</span></code></pre>
</li>
<li><p><strong>MockHttpServletRequestBuilder：</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//：添加头信息；</span>
MockHttpServletRequestBuilder <span class="token function">header</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span><span class="token operator">/</span>MockHttpServletRequestBuilder <span class="token function">headers</span><span class="token punctuation">(</span>HttpHeaders httpHeaders<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求的contentType头信息；</span>
MockHttpServletRequestBuilder <span class="token function">contentType</span><span class="token punctuation">(</span>MediaType mediaType<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求的Accept头信息；</span>
MockHttpServletRequestBuilder <span class="token function">accept</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> mediaTypes<span class="token punctuation">)</span><span class="token operator">/</span>MockHttpServletRequestBuilder <span class="token function">accept</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> mediaTypes<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求Body体内容；</span>
MockHttpServletRequestBuilder <span class="token function">content</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content<span class="token punctuation">)</span><span class="token operator">/</span>MockHttpServletRequestBuilder <span class="token function">content</span><span class="token punctuation">(</span>String content<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：请求传入参数</span>
MockHttpServletRequestBuilder <span class="token function">param</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求的Cookie；</span>
MockHttpServletRequestBuilder <span class="token function">cookie</span><span class="token punctuation">(</span>Cookie<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> cookies<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求的Locale；</span>
MockHttpServletRequestBuilder <span class="token function">locale</span><span class="token punctuation">(</span>Locale locale<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求字符编码；</span>
MockHttpServletRequestBuilder <span class="token function">characterEncoding</span><span class="token punctuation">(</span>String encoding<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：设置请求属性数据；</span>
MockHttpServletRequestBuilder <span class="token function">requestAttr</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">//：设置请求session属性数据；</span>
MockHttpServletRequestBuilder <span class="token function">sessionAttr</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span><span class="token operator">/</span>MockHttpServletRequestBuilder <span class="token function">sessionAttrs</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> object<span class="token operator">=</span><span class="token string">""</span><span class="token operator">></span> sessionAttributes<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//指定请求的flash信息，比如重定向后的属性信息；</span>
MockHttpServletRequestBuilder <span class="token function">flashAttr</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span><span class="token operator">/</span>MockHttpServletRequestBuilder <span class="token function">flashAttrs</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> object<span class="token operator">=</span><span class="token string">""</span><span class="token operator">></span> flashAttributes<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求的Session；</span>
MockHttpServletRequestBuilder <span class="token function">session</span><span class="token punctuation">(</span>MockHttpSession session<span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">// ：指定请求的Principal；</span>
MockHttpServletRequestBuilder <span class="token function">principal</span><span class="token punctuation">(</span>Principal principal<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：指定请求的上下文路径，必须以“/”开头，且不能以“/”结尾；</span>
MockHttpServletRequestBuilder <span class="token function">contextPath</span><span class="token punctuation">(</span>String contextPath<span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">//：请求的路径信息，必须以“/”开头；</span>
MockHttpServletRequestBuilder <span class="token function">pathInfo</span><span class="token punctuation">(</span>String pathInfo<span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">//：请求是否使用安全通道；</span>
MockHttpServletRequestBuilder <span class="token function">secure</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> secure<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：请求的后处理器，用于自定义一些请求处理的扩展点；</span>
MockHttpServletRequestBuilder <span class="token function">with</span><span class="token punctuation">(</span>RequestPostProcessor postProcessor<span class="token punctuation">)</span></code></pre>
</li>
<li><p><strong>MockMultipartHttpServletRequestBuilder</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//：指定要上传的文件；</span>
MockMultipartHttpServletRequestBuilder <span class="token function">file</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content<span class="token punctuation">)</span><span class="token operator">/</span>MockMultipartHttpServletRequestBuilder <span class="token function">file</span><span class="token punctuation">(</span>MockMultipartFile file<span class="token punctuation">)</span></code></pre>
</li>
<li><p><strong>ResultActions</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//：添加验证断言来判断执行请求后的结果是否是预期的；</span>
ResultActions <span class="token function">andExpect</span><span class="token punctuation">(</span>ResultMatcher matcher<span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">//：添加结果处理器，用于对验证成功后执行的动作，如输出下请求/结果信息用于调试；</span>
ResultActions <span class="token function">andDo</span><span class="token punctuation">(</span>ResultHandler handler<span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">//：返回验证成功后的MvcResult；用于自定义验证/下一步的异步处理；</span>
MvcResult <span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
</li>
<li><p><strong>ResultMatcher/MockMvcResultMatchers</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//：请求的Handler验证器，比如验证处理器类型/方法名；此处的Handler其实就是处理请求的控制器；</span>
HandlerResultMatchers <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到RequestResultMatchers验证器；</span>
RequestResultMatchers <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到模型验证器；</span>
ModelResultMatchers <span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到视图验证器；</span>
ViewResultMatchers <span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到Flash属性验证；</span>
FlashAttributeResultMatchers <span class="token function">flash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到响应状态验证器；</span>
StatusResultMatchers <span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到响应Header验证器；</span>
HeaderResultMatchers <span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到响应Cookie验证器；</span>
CookieResultMatchers <span class="token function">cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到响应内容验证器；</span>
ContentResultMatchers <span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到Json表达式验证器；</span>
JsonPathResultMatchers <span class="token function">jsonPath</span><span class="token punctuation">(</span>String expression<span class="token punctuation">,</span> Object <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span><span class="token operator">/</span>ResultMatcher <span class="token function">jsonPath</span><span class="token punctuation">(</span>String expression<span class="token punctuation">,</span> Matcher matcher<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：得到Xpath表达式验证器；</span>
XpathResultMatchers <span class="token function">xpath</span><span class="token punctuation">(</span>String expression<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span><span class="token operator">/</span>XpathResultMatchers <span class="token function">xpath</span><span class="token punctuation">(</span>String expression<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">=</span><span class="token string">""</span><span class="token operator">></span> namespaces<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：验证处理完请求后转发的url（绝对匹配）；</span>
ResultMatcher <span class="token function">forwardedUrl</span><span class="token punctuation">(</span><span class="token keyword">final</span> String expectedUrl<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：验证处理完请求后转发的url（Ant风格模式匹配，@since spring4）；</span>
ResultMatcher <span class="token function">forwardedUrlPattern</span><span class="token punctuation">(</span><span class="token keyword">final</span> String urlPattern<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：验证处理完请求后重定向的url（绝对匹配）；</span>
ResultMatcher <span class="token function">redirectedUrl</span><span class="token punctuation">(</span><span class="token keyword">final</span> String expectedUrl<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//：验证处理完请求后重定向的url（Ant风格模式匹配，@since spring4）；</span>
ResultMatcher <span class="token function">redirectedUrlPattern</span><span class="token punctuation">(</span><span class="token keyword">final</span> String expectedUrl<span class="token punctuation">)</span></code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="2-Mockito"><a href="#2-Mockito" class="headerlink" title="2-Mockito"></a>2-Mockito</h2><h3 id="2-1-什么是Mockito？"><a href="#2-1-什么是Mockito？" class="headerlink" title="2.1-什么是Mockito？"></a>2.1-什么是Mockito？</h3><p>Mockito是mocking框架，它让你用简洁的API做测试。而且Mockito简单易学，它可读性强和验证语法简洁。<br>Mockito是GitHub上使用最广泛的Mock框架,并与JUnit结合使用.Mockito框架可以创建和配置mock对象.使用Mockito简化了具有外部依赖的类的测试开发。</p>
<h3 id="2-2-使用模拟对象进行测试"><a href="#2-2-使用模拟对象进行测试" class="headerlink" title="2.2-使用模拟对象进行测试"></a>2.2-使用模拟对象进行测试</h3><h4 id="2-2-1-单元测试的目标和挑战"><a href="#2-2-1-单元测试的目标和挑战" class="headerlink" title="2.2.1-单元测试的目标和挑战"></a>2.2.1-单元测试的目标和挑战</h4><p>单元测试应单独测试功能。如有可能，应消除其他类别或系统的副作用，以进行单元测试。</p>
<p>这可以通过对真正的依赖项使用测试替换（<em>test doubles</em>）来完成。双重测试可以分为以下几类：</p>
<ul>
<li>一个<em>虚拟对象</em>被传来传去，但从来没有使用过，即它的方法永远不会被调用。这样的对象可以例如用于填充方法的参数列表。</li>
<li><em>伪</em>对象具有有效的实现，但通常可以简化。例如，他们使用内存数据库而不是真实数据库。</li>
<li><em>存根</em>类是一个接口或类与在测试过程中使用该存根类的一个实例的目的的部分实施。存根通常不对测试中编程的内容做出任何反应。存根可能还会记录有关呼叫的信息。</li>
<li><em>模拟对象</em>是在其中定义某些方法调用的输出接口或类伪实现。模拟对象配置为在测试期间执行某些行为。他们通常记录与系统的交互，测试可以验证这一点。</li>
</ul>
<p>可以将测试双打传递给其他要测试的对象。您的测试可以验证该类在测试过程中的正确反应。例如，您可以验证是否调用了模拟对象上的某些方法。这有助于确保您仅在运行测试时对类进行测试，并且确保测试不受任何副作用的影响。</p>
<h4 id="2-2-2-模拟对象生成"><a href="#2-2-2-模拟对象生成" class="headerlink" title="2.2.2-模拟对象生成"></a>2.2.2-模拟对象生成</h4><p>您可以手动（通过代码）创建模拟对象，也可以使用模拟框架来模拟这些类。模拟框架允许您在运行时创建模拟对象并定义其行为。</p>
<p>模拟对象的经典示例是数据提供程序。在生产中，使用了连接到真实数据源的实现。但是对于测试，模拟对象会模拟数据源并确保测试条件始终相同。</p>
<p>可以将这些模拟对象提供给要测试的类。因此，要测试的类应避免对外部数据的任何硬性依赖。</p>
<p>模拟或模拟框架允许测试与模拟对象的预期交互。例如，您可以验证仅在模拟对象上调用了某些方法。</p>
<h4 id="2-2-3-使用Mockito模拟对象"><a href="#2-2-3-使用Mockito模拟对象" class="headerlink" title="2.2.3-使用Mockito模拟对象"></a>2.2.3-使用Mockito模拟对象</h4><p><em>Mockito</em>是一种流行的模拟框架，可以与JUnit结合使用。Mockito允许您创建和配置模拟对象。使用Mockito大大简化了具有外部依赖项的类的测试开发。</p>
<p>如果在测试中使用Mockito，通常会按照以下步骤：</p>
<ul>
<li>模拟掉外部依赖关系并将模拟插入待测代码</li>
<li>执行被测代码</li>
<li>验证代码是否正确执行</li>
</ul>
<h3 id="2-3-Mockito的使用"><a href="#2-3-Mockito的使用" class="headerlink" title="2.3-Mockito的使用"></a>2.3-Mockito的使用</h3><h4 id="2-3-1-引入pom依赖"><a href="#2-3-1-引入pom依赖" class="headerlink" title="2.3.1-引入pom依赖"></a>2.3.1-引入pom依赖</h4><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mockito<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mockito-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
<h4 id="2-3-2-测试类中引入静态资源"><a href="#2-3-2-测试类中引入静态资源" class="headerlink" title="2.3.2-测试类中引入静态资源"></a>2.3.2-测试类中引入静态资源</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span>Mockito<span class="token punctuation">.</span>*<span class="token punctuation">;</span> </code></pre>
<h4 id="2-3-3-常用的Mockito方法"><a href="#2-3-3-常用的Mockito方法" class="headerlink" title="2.3.3-常用的Mockito方法"></a>2.3.3-常用的Mockito方法</h4><table>
<thead>
<tr>
<th><strong>方法名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Mockito.mock(classToMock)</td>
<td>模拟对象</td>
</tr>
<tr>
<td>Mockito.verify(mock)</td>
<td>验证行为是否发生</td>
</tr>
<tr>
<td>Mockito.when(methodCall).thenReturn(value1).thenReturn(value2)</td>
<td>触发时第一次返回value1，第n次都返回value2</td>
</tr>
<tr>
<td>Mockito.doThrow(toBeThrown).when(mock).[method]</td>
<td>模拟抛出异常。</td>
</tr>
<tr>
<td>Mockito.mock(classToMock,defaultAnswer)</td>
<td>使用默认Answer模拟对象</td>
</tr>
<tr>
<td>Mockito.when(methodCall).thenReturn(value)</td>
<td>参数匹配</td>
</tr>
<tr>
<td>Mockito.doReturn(toBeReturned).when(mock).[method]</td>
<td>参数匹配（直接执行不判断）</td>
</tr>
<tr>
<td>Mockito.when(methodCall).thenAnswer(answer))</td>
<td>预期回调接口生成期望值</td>
</tr>
<tr>
<td>Mockito.doAnswer(answer).when(methodCall).[method]</td>
<td>预期回调接口生成期望值（直接执行不判断）</td>
</tr>
<tr>
<td>Mockito.spy(Object)</td>
<td>用spy监控真实对象,设置真实对象行为</td>
</tr>
<tr>
<td>Mockito.doNothing().when(mock).[method]</td>
<td>不做任何返回</td>
</tr>
<tr>
<td>Mockito.doCallRealMethod().when(mock).[method] //等价于Mockito.when(mock.[method]).thenCallRealMethod();</td>
<td>调用真实的方法</td>
</tr>
<tr>
<td>reset(mock)</td>
<td>重置mock</td>
</tr>
</tbody></table>
<h4 id="2-3-4-示例"><a href="#2-3-4-示例" class="headerlink" title="2.3.4-示例"></a>2.3.4-示例</h4><h5 id="1-验证某些行为确实发生过（有没有被调用过）"><a href="#1-验证某些行为确实发生过（有没有被调用过）" class="headerlink" title="1. 验证某些行为确实发生过（有没有被调用过）"></a>1. 验证某些行为确实发生过（有没有被调用过）</h5><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 静态导入会使代码更简洁</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span>Mockito<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// mock creation 创建mock对象</span>
List mockedList <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//using mock object 使用mock对象</span>
<span class="token comment" spellcheck="true">//验证add方法是否在前面被调用了一次，且参数为“one”。clear方法同样。</span>
mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mockedList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//verification 验证</span>
<span class="token comment" spellcheck="true">//下面的验证会失败。因为没有调用过add("two")。</span>
<span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>一旦mock对象被创建了，mock对象会记住所有的交互。然后你就可能选择性的验证你感兴趣的交互。</p>
<h5 id="2-如何做一些测试桩（Stub）"><a href="#2-如何做一些测试桩（Stub）" class="headerlink" title="2. 如何做一些测试桩（Stub）"></a>2. 如何做一些测试桩（Stub）</h5><p>Mockito可以预设方法返回值，称为stubbing。如果这个方法没被stubbing，则默认返回null，0，false，空集合之类的。</p>
<pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">// 你可以mock具体的类型,不仅只是接口</span>
 LinkedList mockedList <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>LinkedList<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//stubbing</span>
 <span class="token comment" spellcheck="true">// 测试桩</span>
 <span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// 输出“first”</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 抛出异常</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 因为get(999) 没有打桩，因此输出null</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// 验证get(0)被调用的次数</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>插桩：使mock对象的方法返回期望值<br>对于没有stub过的有返回值的方法，会返回默认值（0，false，null等）</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//stubbing。当get(0)被调用时，返回"first". 方法get(1)被调用时，抛异常。</span>
<span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>重复stub</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//重复stub，以最后一次为准，如下将返回"second"：</span>
<span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//如下表示第一次调用时返回“first”，第二次调用时返回“second”。可以写n个。</span>
<span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
如果实际调用的次数超过了stub过的次数，则返回最后一次stub的值。
例如第三次调用<span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>时，则会返回<span class="token string">"second"</span><span class="token punctuation">.</span></code></pre>
<ul>
<li>默认情况下，所有的函数都有返回值。mock函数默认返回的是null，一个空的集合或者一个被对象类型包装的内置类型，例如0、false对应的对象类型为Integer、Boolean；</li>
<li>测试桩函数可以被覆写 : 例如常见的测试桩函数可以用于初始化夹具，但是测试函数能够覆写它。请注意，覆写测试桩函数是一种可能存在潜在问题的做法；</li>
<li>一旦测试桩函数被调用，该函数将会一致返回固定的值；</li>
<li>上一次调用测试桩函数有时候极为重要-当你调用一个函数很多次时，最后一次调用可能是你所感兴趣的。</li>
</ul>
<h5 id="3-参数匹配器（matchers）"><a href="#3-参数匹配器（matchers）" class="headerlink" title="3. 参数匹配器（matchers）"></a>3. 参数匹配器（matchers）</h5><p>Mockito以自然的java风格来验证参数值: 使用equals()函数。有时，当需要额外的灵活性时你可能需要使用参数匹配器，也就是argument matchers :</p>
<p><code>Mockito.anyInt()</code> 任何 int 值 ；<br> <code>Mockito.anyLong()</code> 任何 long 值 ；<br> <code>Mockito.anyString()</code> 任何 String 值 ；</p>
<p><code>Mockito.any(XXX.class)</code> 任何 XXX 类型的值 等等。</p>
<pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">// 使用内置的anyInt()参数匹配器</span>
 <span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 使用自定义的参数匹配器( 在isValid()函数中返回你自己的匹配器实现 )</span>
 <span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token function">argThat</span><span class="token punctuation">(</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 输出element</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 你也可以验证参数匹配器</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//argument matchers can also be written as Java 8 Lambdas</span>
<span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">argThat</span><span class="token punctuation">(</span>someString <span class="token operator">-</span><span class="token operator">></span> someString<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 需要注意的是，如果使用Argument matchers，那么所有参数都必须由其提供。</span>
<span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"third argument"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//above is correct - eq() is also an argument matcher</span>
<span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"third argument"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//above is incorrect - exception will be thrown because third argument is givenwithout an argument matcher.</span></code></pre>
<p>参数匹配器使验证和测试桩变得更灵活。<a href="http://site.mockito.org/mockito/docs/current/org/mockito/Matchers.html" target="_blank" rel="noopener">点击这里</a>查看更多内置的匹配器以及自定义参数匹配器或者hamcrest 匹配器的示例。</p>
<p>如果仅仅是获取自定义参数匹配器的信息，查看<a href="http://site.mockito.org/mockito/docs/current/org/mockito/ArgumentMatcher.html" target="_blank" rel="noopener">ArgumentMatcher类文档</a>即可。</p>
<p>为了合理的使用复杂的参数匹配，使用equals()与anyX() 的匹配器会使得测试代码更简洁、简单。有时，会迫使你重构代码以使用equals()匹配或者实现equals()函数来帮助你进行测试。</p>
<p>同时建议你阅读<a href="https://github.com/hehonghui/mockito-doc-zh#sec_15" target="_blank" rel="noopener">第15章节</a>或者<a href="http://site.mockito.org/mockito/docs/current/org/mockito/ArgumentCaptor.html" target="_blank" rel="noopener">ArgumentCaptor类文档</a>。ArgumentCaptor是一个能够捕获参数值的特俗参数匹配器。</p>
<p><strong>参数匹配器的注意点 :</strong></p>
<p>如果你使用参数匹配器,所有参数都必须由匹配器提供。</p>
<p>示例 : ( 该示例展示了如何多次应用于测试桩函数的验证 )</p>
<pre class=" language-java"><code class="language-java"><span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"third argument"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//above is correct - eq() is also an argument matcher</span>
<span class="token comment" spellcheck="true">// 上述代码是正确的,因为eq()也是一个参数匹配器</span>

<span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"third argument"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//above is incorrect - exception will be thrown because third argument </span>
<span class="token comment" spellcheck="true">// 上述代码是错误的,因为所有参数必须由匹配器提供，而参数"third argument"并非由参数匹配器提供，因此的缘故会抛出异常</span></code></pre>
<p>像anyObject(), eq()这样的匹配器函数不会返回匹配器。它们会在内部将匹配器记录到一个栈当中，并且返回一个假的值，通常为null。<code>这样的实现是由于被Java编译器强加的静态类型安全</code>。结果就是你不能在验证或者测试桩函数之外使用anyObject(), eq()函数。</p>
<h5 id="4-验证函数的确切、最少、从未调用次数"><a href="#4-验证函数的确切、最少、从未调用次数" class="headerlink" title="4. 验证函数的确切、最少、从未调用次数"></a>4. 验证函数的确切、最少、从未调用次数</h5><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//using mock</span>
 mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"once"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"twice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"twice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//following two verifications work exactly the same - times(1) is used by default</span>
 <span class="token comment" spellcheck="true">// 下面的两个验证函数效果一样,因为verify默认验证的就是times(1)</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"once"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"once"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//exact number of invocations verification</span>
 <span class="token comment" spellcheck="true">// 验证具体的执行次数</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"twice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//verification using never(). never() is an alias to times(0)</span>
 <span class="token comment" spellcheck="true">// 使用never()进行验证,never相当于times(0)</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"never happened"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//verification using atLeast()/atMost()</span>
 <span class="token comment" spellcheck="true">// 使用atLeast()/atMost()</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">atLeastOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">atLeast</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"five times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">,</span> <span class="token function">atMost</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three times"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>verify函数默认验证的是执行了times(1)，也就是某个测试函数是否执行了1次.因此，times(1)通常被省略了。</p>
<h5 id="5-为返回值为void的函数通过Stub抛出异常"><a href="#5-为返回值为void的函数通过Stub抛出异常" class="headerlink" title="5. 为返回值为void的函数通过Stub抛出异常"></a>5. 为返回值为void的函数通过Stub抛出异常</h5><pre class=" language-java"><code class="language-java"><span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//following throws RuntimeException:</span>
<span class="token comment" spellcheck="true">// 调用这句代码会抛出异常</span>
mockedList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>最初，<a href="http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html#stubVoid(T)" target="_blank" rel="noopener">stubVoid(Object)</a> 函数用于为无返回值的函数打桩。现在stubVoid()函数已经过时,doThrow(Throwable)成为了它的继承者。这是为了提升与 doAnswer(Answer) 函数族的可读性与一致性。</p>
<h5 id="6-验证调用执行顺序"><a href="#6-验证调用执行顺序" class="headerlink" title="6. 验证调用执行顺序"></a>6. 验证调用执行顺序</h5><pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">// A. 验证mock一个对象的函数执行顺序</span>
 List singleMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//using a single mock</span>
 singleMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was added first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 singleMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was added second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// 为该mock对象创建一个inOrder对象</span>
 InOrder inOrder <span class="token operator">=</span> <span class="token function">inOrder</span><span class="token punctuation">(</span>singleMock<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// 确保add函数首先执行的是add("was added first"),然后才是add("was added second")</span>
 inOrder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>singleMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was added first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 inOrder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>singleMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was added second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// B .验证多个mock对象的函数执行顺序</span>
 List firstMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 List secondMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//using mocks</span>
 firstMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was called first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 secondMock<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was called second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// 为这两个Mock对象创建inOrder对象</span>
 InOrder inOrder <span class="token operator">=</span> <span class="token function">inOrder</span><span class="token punctuation">(</span>firstMock<span class="token punctuation">,</span> secondMock<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">// 验证它们的执行顺序</span>
 inOrder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>firstMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was called first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 inOrder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>secondMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"was called second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// Oh, and A + B can be mixed together at will</span></code></pre>
<p>验证执行顺序是非常灵活的-你不需要一个一个的验证所有交互,只需要验证你感兴趣的对象即可。 另外，你可以仅通过那些需要验证顺序的mock对象来创建InOrder对象。</p>
<h5 id="7-确保交互-interaction-操作不会执行在mock对象上"><a href="#7-确保交互-interaction-操作不会执行在mock对象上" class="headerlink" title="7. 确保交互(interaction)操作不会执行在mock对象上"></a>7. 确保交互(interaction)操作不会执行在mock对象上</h5><pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">// 使用Mock对象</span>
 mockOne<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 普通验证</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockOne<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 验证某个交互是否从未被执行</span>
 <span class="token function">verify</span><span class="token punctuation">(</span>mockOne<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">// 验证mock对象没有交互过</span>
 <span class="token function">verifyZeroInteractions</span><span class="token punctuation">(</span>mockTwo<span class="token punctuation">,</span> mockThree<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h5 id="8-查找冗余的调用"><a href="#8-查找冗余的调用" class="headerlink" title="8. 查找冗余的调用"></a>8. 查找冗余的调用</h5><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//using mocks</span>
mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mockedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">verify</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//following verification will fail</span>
<span class="token comment" spellcheck="true">// 下面的验证将会失败</span>
<span class="token function">verifyNoMoreInteractions</span><span class="token punctuation">(</span>mockedList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>一些用户可能会在频繁地使用<code>verifyNoMoreInteractions()</code>，甚至在每个测试函数中都用。但是<code>verifyNoMoreInteractions()</code>并不建议在每个测试函数中都使用。<code>verifyNoMoreInteractions()</code>在交互测试套件中只是一个便利的验证，它的作用是当你需要验证是否存在冗余调用时。滥用它将导致测试代码的可维护性降低。你可以阅读<a href="http://monkeyisland.pl/2008/07/12/should-i-worry-about-the-unexpected/" target="_blank" rel="noopener">这篇文档</a>来了解更多相关信息。</p>
<p><code>never()</code>是一种更为明显且易于理解的形式。</p>
<h5 id="9-简化mock对象的创建"><a href="#9-简化mock对象的创建" class="headerlink" title="9. 简化mock对象的创建"></a>9. 简化mock对象的创建</h5><ul>
<li>最小化重复的创建代码</li>
<li>使测试类的代码可读性更高</li>
<li>使验证错误更易于阅读，因为字段名可用于标识mock对象</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleManagerTest</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Mock</span> <span class="token keyword">private</span> ArticleCalculator calculator<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Mock</span> <span class="token keyword">private</span> ArticleDatabase database<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Mock</span> <span class="token keyword">private</span> UserProvider userProvider<span class="token punctuation">;</span>

   <span class="token keyword">private</span> ArticleManager manager<span class="token punctuation">;</span></code></pre>
<p>注意！下面这句代码需要在运行测试函数之前被调用,一般放到测试类的基类或者test runner中:</p>
<pre class=" language-java"><code class="language-java"> MockitoAnnotations<span class="token punctuation">.</span><span class="token function">initMocks</span><span class="token punctuation">(</span>testClass<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>你可以使用内置的runner: <a href="http://site.mockito.org/mockito/docs/current/org/mockito/runners/MockitoJUnitRunner.html" target="_blank" rel="noopener">MockitoJUnitRunner</a> <a href="http://site.mockito.org/mockito/docs/current/org/mockito/runners/MockitoJUnitRunner.html" target="_blank" rel="noopener">runner</a> 或者一个rule : <a href="http://site.mockito.org/mockito/docs/current/org/mockito/junit/MockitoRule.html" target="_blank" rel="noopener">MockitoRule</a>。 关于mock注解的更多信息可以阅读<a href="http://site.mockito.org/mockito/docs/current/org/mockito/MockitoAnnotations.html" target="_blank" rel="noopener">MockitoAnnotations文档</a>。</p>
<p><strong>有2种启用Mockito注解的方法：</strong></p>
<ul>
<li>写个@Before(JUnit4)方法，里边调用MockitoAnnotations.initMocks(this)方法。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Before</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MockitoAnnotations<span class="token punctuation">.</span><span class="token function">initMocks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>可以直接使用built-in runner: MockitoJUnitRunner。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>MockitoJUnitRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></code></pre>
<h5 id="10-为连续的调用做测试桩-stub"><a href="#10-为连续的调用做测试桩-stub" class="headerlink" title="10. 为连续的调用做测试桩 (stub)"></a>10. 为连续的调用做测试桩 (stub)</h5><p>有时我们需要为同一个函数调用的不同的返回值或异常做测试桩。典型的运用就是使用mock迭代器。 原始版本的Mockito并没有这个特性，例如，可以使用Iterable或者简单的集合来替换迭代器。这些方法提供了更自然的方式，在一些场景中为连续的调用做测试桩会很有用。示例如下 ：</p>
<pre class=" language-java"><code class="language-java"> <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">"some arg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//First call: throws runtime exception:</span>
 <span class="token comment" spellcheck="true">// 第一次调用 : 抛出运行时异常</span>
 mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">"some arg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//Second call: prints "foo"</span>
 <span class="token comment" spellcheck="true">// 第二次调用 : 输出"foo"</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">"some arg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//Any consecutive call: prints "foo" as well (last stubbing wins).</span>
 <span class="token comment" spellcheck="true">// 后续调用 : 也是输出"foo"</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">"some arg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>另外，连续调用的另一种更简短的版本 :</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 第一次调用时返回"one",第二次返回"two",第三次返回"three"</span>
 <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">"some arg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h5 id="11-为回调做测试桩"><a href="#11-为回调做测试桩" class="headerlink" title="11. 为回调做测试桩"></a>11. 为回调做测试桩</h5><p>Allows stubbing with generic Answer interface. 运行为泛型接口Answer打桩。</p>
<p>在最初的Mockito里也没有这个具有争议性的特性。我们建议使用thenReturn() 或thenThrow()来打桩。这两种方法足够用于测试或者测试驱动开发。</p>
<pre class=" language-java"><code class="language-java"> <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     Object <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         Object mock <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token string">"called with arguments: "</span> <span class="token operator">+</span> args<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">//Following prints "called with arguments: foo"</span>
 <span class="token comment" spellcheck="true">// 输出 : "called with arguments: foo"</span>
 System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h5 id="12-doReturn-、doThrow-、doAnswer-、doNothing-、doCallRealMethod-系列方法的运用"><a href="#12-doReturn-、doThrow-、doAnswer-、doNothing-、doCallRealMethod-系列方法的运用" class="headerlink" title="12. doReturn()、doThrow()、doAnswer()、doNothing()、doCallRealMethod()系列方法的运用"></a>12. doReturn()、doThrow()、doAnswer()、doNothing()、doCallRealMethod()系列方法的运用</h5><p>通过<code>when(Object)</code>为无返回值的函数打桩有不同的方法,因为编译器不喜欢void函数在括号内…</p>
<p>使用<code>doThrow(Throwable)</code> 替换<code>stubVoid(Object)</code>来为void函数打桩是为了与<code>doAnswer()</code>等函数族保持一致性。</p>
<p>当你想为void函数打桩时使用含有一个exception 参数的<code>doAnswer()</code> :</p>
<pre><code>doThrow(new RuntimeException()).when(mockedList).clear();

//following throws RuntimeException:
// 下面的代码会抛出异常
mockedList.clear();</code></pre><p>当你调用<code>doThrow()</code>, <code>doAnswer()</code>, <code>doNothing()</code>, <code>doReturn()</code> and <code>doCallRealMethod()</code> 这些函数时可以在适当的位置调用<code>when()</code>函数. 当你需要下面这些功能时这是必须的:</p>
<ul>
<li>测试void函数</li>
<li>在受监控的对象上测试函数</li>
<li>不知一次的测试为同一个函数，在测试过程中改变mock对象的行为。</li>
</ul>
<p>但是在调用<code>when()</code>函数时你可以选择是否调用这些上述这些函数。</p>
<ul>
<li><p><strong>doReturn(Object toBeReturned)</strong></p>
<p>使用<code>doReturn()</code>在那些极少数情况下，你不能使用<a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html#when-T-" target="_blank" rel="noopener"><code>when(Object)</code></a>。</p>
<p><strong>注意<a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html#when-T-" target="_blank" rel="noopener"><code>when(Object)</code></a>始终建议进行存根，因为它是参数类型安全的，并且更具可读性</strong>（尤其是在存续的调用存根时）。</p>
<p>以下是doReturn（）派上用场的罕见情况：</p>
</li>
</ul>
<ol>
<li><p>监视真实对象并在间谍上调用真实方法时会带来副作用</p>
<pre class=" language-java"><code class="language-java">   List list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   List spy <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//Impossible: real method is called so spy.get(0) throws IndexOutOfBoundsException (the list is yet empty)</span>
   <span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//You have to use doReturn() for stubbing:</span>
   <span class="token function">doReturn</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>覆盖先前的异常处理：</p>
<pre class=" language-java"><code class="language-java">   <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//Impossible: the exception-stubbed foo() method is called so RuntimeException is thrown.</span>
   <span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//You have to use doReturn() for stubbing:</span>
   <span class="token function">doReturn</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>以上方案展示了Mockito优雅语法的折衷方案。请注意，这种情况很少见。间谍活动应该是零星的，并且覆盖异常例外非常少见。更不用说总的来说，过度存根是一种潜在的代码气味，它指出了太多的存根。</p>
</li>
</ol>
<ul>
<li><p><strong>doThrow(Throwable… toBeThrown)</strong></p>
<p>使用<code>doThrow()</code>时要与存根异常的无效方法。</p>
<p><a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html#when-T-" target="_blank" rel="noopener"><code>when(Object)</code></a>对空进行 存根需要的方法与之不同，因为编译器不喜欢方括号内的空方法…</p>
<p>例：</p>
<pre class=" language-java"><code class="language-java"><span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li><p>参数：</p>
<p><code>toBeThrown</code> -调用存根方法时抛出</p>
</li>
<li><p>返回值：</p>
<p>存根-选择存根方法</p>
</li>
</ul>
</li>
<li><p><strong>doThrow(Class&lt;? extends Throwable&gt; toBeThrown)</strong></p>
<p>使用<code>doThrow()</code>时要与存根异常的无效方法。</p>
<p>将为每个方法调用创建一个新的异常实例。</p>
<p><a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html#when-T-" target="_blank" rel="noopener"><code>when(Object)</code></a>对空进行 存根需要的方法与之不同，因为编译器不喜欢方括号内的空方法…</p>
<p>例：</p>
<pre class=" language-java"><code class="language-java"><span class="token function">doThrow</span><span class="token punctuation">(</span>RuntimeException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li><p>参数：</p>
<p><code>toBeThrown</code> -调用存根方法时抛出</p>
</li>
<li><p>返回值：</p>
<p>存根-选择存根方法</p>
</li>
</ul>
</li>
<li><p><strong>doAnswer(Answer answer)</strong></p>
<p><code>doAnswer()</code>当您想用generic对无效方法进行存根时使用<a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/stubbing/Answer.html" target="_blank" rel="noopener"><code>Answer</code></a>。</p>
<p><a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html#when-T-" target="_blank" rel="noopener"><code>when(Object)</code></a>对空进行 存根需要的方法与之不同，因为编译器不喜欢方括号内的空方法…</p>
<p>例：</p>
<pre class=" language-java"><code class="language-java">  <span class="token function">doAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> Object <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Mock mock <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> null<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>请参阅Javadoc中的<a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html" target="_blank" rel="noopener"><code>Mockito</code></a>类示例</p>
<ul>
<li><p>参数：</p>
<p><code>answer</code> -在调用存根方法时回答</p>
</li>
<li><p>返回值：</p>
<p>存根-选择存根方法</p>
</li>
</ul>
</li>
<li><p><strong>doNothing（）</strong></p>
<p>使用<code>doNothing()</code>设置无效的方法什么也不做。<strong>注意，默认情况下，模拟上的void方法什么也不做！</strong> 但是，在少数情况下，doNothing（）会派上用场：</p>
<ol>
<li><p>取消对void方法的连续调用：</p>
<pre class=" language-java"><code class="language-java">   <span class="token function">doNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
   <span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//does nothing the first time:</span>
   mock<span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//throws RuntimeException the next time:</span>
   mock<span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>当您监视真实对象并且您希望void方法不执行任何操作时：</p>
<pre class=" language-java"><code class="language-java">   List list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   List spy <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//let's make clear() do nothing</span>
   <span class="token function">doNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//clear() does nothing, so the list still contains "one"</span>
   spy<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
</ol>
</li>
<li><p><strong>doCallRealMethod（）</strong></p>
<p>使用<code>doCallRealMethod()</code>时要调用真正执行的方法。</p>
<p>像往常一样，您将阅读<strong>部分模拟警告</strong>：面向对象的编程通过将复杂度划分为单独的，特定的SRPy对象来解决复杂度问题。部分模拟如何适应这种范例？好吧，事实并非如此……部分模拟通常意味着复杂性已移至同一对象的不同方法。在大多数情况下，这不是您设计应用程序的方式。</p>
<p>但是，在少数情况下，局部模拟会派上用场：处理您无法轻松更改的代码（第三方接口，遗留代码的临时重构等）。但是，我不会将局部模拟用于新的，测试驱动的以及设计的代码。</p>
<p>另请参见javadoc <a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html#spy-T-" target="_blank" rel="noopener"><code>spy(Object)</code></a>以了解有关部分模拟的更多信息。 <strong>Mockito.spy（）是创建部分模拟的推荐方法。</strong> 原因是它保证针对正确构造的对象调用真实方法，因为您负责构造传递给spy（）方法的对象。</p>
<p>例：</p>
<pre class=" language-java"><code class="language-java">   Foo mock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">doCallRealMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// this will call the real implementation of Foo.someVoidMethod()</span>
   mock<span class="token punctuation">.</span><span class="token function">someVoidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>请参阅Javadoc中的<a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html" target="_blank" rel="noopener"><code>Mockito</code></a>类示例</p>
<ul>
<li><p>返回值：</p>
<p>存根-选择存根方法</p>
</li>
</ul>
</li>
</ul>
<h5 id="13-监控真实对象"><a href="#13-监控真实对象" class="headerlink" title="13.  监控真实对象"></a>13.  监控真实对象</h5><p>你可以为真实对象创建一个监控(spy)对象。当你使用这个spy对象时真实的对象也会也调用，除非它的函数被stub了。尽量少使用spy对象，使用时也需要小心形式，例如spy对象可以用来处理遗留代码。</p>
<p>监控一个真实的对象可以与“局部mock对象”概念结合起来。在1.8之前，mockito的监控功能并不是真正的局部mock对象。原因是我们认为局部mock对象的实现方式并不好，在某些时候我发现一些使用局部mock对象的合法用例。（第三方接口、临时重构遗留代码，完整的文章在<a href="http://monkeyisland.pl/2009/01/13/subclass-and-override-vs-partial-mocking-vs-refactoring/" target="_blank" rel="noopener">这里</a> ）</p>
<pre class=" language-java"><code class="language-java">List list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List spy <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 你可以为某些函数打桩</span>
<span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 通过spy对象调用真实对象的函数</span>
spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 输出第一个元素</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 因为size()函数被打桩了,因此这里返回的是100</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 交互验证</span>
<span class="token function">verify</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">verify</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>理解监控真实对象非常重要！</p>
<p>有时，在监控对象上使用<code>when(Object)</code>来进行打桩是不可能或者不切实际的。因此，当使用监控对象时请考虑<code>doReturn|Answer|Throw()</code>函数族来进行打桩。例如 :</p>
<pre class=" language-java"><code class="language-java">List list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List spy <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 不可能 : 因为当调用spy.get(0)时会调用真实对象的get(0)函数,此时会发生IndexOutOfBoundsException异常，因为真实List对象是空的</span>
   <span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 你需要使用doReturn()来打桩</span>
<span class="token function">doReturn</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Mockito并不会为真实对象代理函数调用，实际上它会拷贝真实对象。因此如果你保留了真实对象并且与之交互，不要期望从监控对象得到正确的结果。当你在监控对象上调用一个没有被stub的函数时并不会调用真实对象的对应函数，你不会在真实对象上看到任何效果。</p>
<p>因此结论就是 : 当你在监控一个真实对象时，你想在stub这个真实对象的函数，那么就是在自找麻烦。或者你根本不应该验证这些函数。</p>
<h5 id="14-修改没有测试桩的调用的默认返回值"><a href="#14-修改没有测试桩的调用的默认返回值" class="headerlink" title="14. 修改没有测试桩的调用的默认返回值"></a>14. 修改没有测试桩的调用的默认返回值</h5><p>你可以指定策略来创建mock对象的返回值。这是一个高级特性，通常来说，你不需要写这样的测试。然后，它对于遗留系统来说是很有用处的。当你不需要为函数调用打桩时你可以指定一个默认的answer。</p>
<pre class=" language-java"><code class="language-java">Foo mock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> Mockito<span class="token punctuation">.</span>RETURNS_SMART_NULLS<span class="token punctuation">)</span><span class="token punctuation">;</span>
Foo mockTwo <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">YourOwnAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>关于RETURNS_SMART_NULLS更多的信息请查看 : <a href="http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html#RETURNS_SMART_NULLS" target="_blank" rel="noopener">RETURNS_SMART_NULLS文档</a> 。</p>
<h5 id="15-为下一步的断言捕获参数"><a href="#15-为下一步的断言捕获参数" class="headerlink" title="15. 为下一步的断言捕获参数"></a>15. 为下一步的断言捕获参数</h5><p>Mockito以java代码风格的形式来验证参数值 : 即通过使用<code>equals()</code>函数。这也是我们推荐用于参数匹配的方式，因为这样会使得测试代码更简单、简洁。在某些情况下，当验证交互之后要检测真实的参数值时这将变得有用。例如 ：</p>
<pre class=" language-java"><code class="language-java">ArgumentCaptor<span class="token operator">&lt;</span>Person<span class="token operator">></span> argument <span class="token operator">=</span> ArgumentCaptor<span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 参数捕获</span>
<span class="token function">verify</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span>argument<span class="token punctuation">.</span><span class="token function">capture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 使用equal断言</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> argument<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>警告 : 我们建议使用没有测试桩的ArgumentCaptor来验证，因为使用含有测试桩的ArgumentCaptor会降低测试代码的可读性，因为captor是在断言代码块之外创建的。另一个好处是它可以降低本地化的缺点，因为如果测试桩函数没有被调用，那么参数就不会被捕获。总之，ArgumentCaptor与自定义的参数匹配器相关(可以查看<a href="https://github.com/hehonghui/mockito-doc-zh/blob/master/ArgumentMatcher" target="_blank" rel="noopener">ArgumentMatcher类的文档</a> )。这两种技术都能用于检测外部传递到Mock对象的参数。然而，使用ArgumentCaptor在以下的情况下更合适 :</p>
<ul>
<li>自定义不能被重用的参数匹配器</li>
<li>你仅需要断言参数值</li>
</ul>
<p>自定义参数匹配器相关的资料你可以参考<a href="https://github.com/hehonghui/mockito-doc-zh/blob/master/ArgumentMatcher" target="_blank" rel="noopener">ArgumentMatcher</a>文档。</p>
<p>更多示例和API请看官方文档——Mockito<a href="https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html" target="_blank" rel="noopener">文档</a></p>
<h4 id="2-3-5-使用Mockito"><a href="#2-3-5-使用Mockito" class="headerlink" title="2.3.5-使用Mockito"></a>2.3.5-使用Mockito</h4><h5 id="1-模拟抛出异常"><a href="#1-模拟抛出异常" class="headerlink" title="1. 模拟抛出异常"></a>1. 模拟抛出异常</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>expected <span class="token operator">=</span> IOException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//期望报IO异常</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">when_thenThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">{</span>
      OutputStream mock <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>OutputStream<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//预设当流关闭时抛出异常</span>
      Mockito<span class="token punctuation">.</span><span class="token function">doThrow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mock<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<h5 id="2-使用默认Answer模拟对象"><a href="#2-使用默认Answer模拟对象" class="headerlink" title="2. 使用默认Answer模拟对象"></a>2. 使用默认Answer模拟对象</h5><p>RETURNS_DEEP_STUBS 是创建mock对象时的备选参数之一</p>
<pre class=" language-java"><code class="language-java">  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      A a<span class="token operator">=</span>Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>Mockito<span class="token punctuation">.</span>RETURNS_DEEP_STUBS<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"Beijing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"Beijing"</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      A a<span class="token operator">=</span>Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      B b<span class="token operator">=</span>Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>B<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"Beijing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"Beijing"</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>
      <span class="token keyword">private</span> B b<span class="token punctuation">;</span>
      <span class="token keyword">public</span> B <span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> b<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setB</span><span class="token punctuation">(</span>B b<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token operator">=</span>b<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>
      <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
      <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> name<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">public</span> String <span class="token function">getSex</span><span class="token punctuation">(</span>Integer sex<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>sex<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token string">"man"</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token string">"woman"</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span></code></pre>
<h5 id="3-参数匹配"><a href="#3-参数匹配" class="headerlink" title="3. 参数匹配"></a>3. 参数匹配</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">with_arguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    B b <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>B<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//预设根据不同的参数返回不同的结果</span>
    Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"女"</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//对于没有预设的情况会返回默认值</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">getSex</span><span class="token punctuation">(</span>Integer sex<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>sex<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"man"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"woman"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="4-匹配任意参数"><a href="#4-匹配任意参数" class="headerlink" title="4. 匹配任意参数"></a>4. 匹配任意参数</h5><p> <code>Mockito.anyInt()</code> 任何 int 值 ；<br> <code>Mockito.anyLong()</code> 任何 long 值 ；<br> <code>Mockito.anyString()</code> 任何 String 值 ；</p>
<p><code>Mockito.any(XXX.class)</code> 任何 XXX 类型的值 等等。</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">with_unspecified_arguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    List list <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//匹配任意参数</span>
    Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">argThat</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">IsValid</span> <span class="token keyword">extends</span> <span class="token class-name">ArgumentMatcher</span><span class="token operator">&lt;</span>List<span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> obj<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><em>注意：使用了参数匹配，那么所有的参数都必须通过matchers来匹配</em><br> Mockito继承Matchers，anyInt()等均为Matchers方法<br> 当传入两个参数，其中一个参数采用任意参数时，指定参数需要matchers来对比</p>
<pre class=" language-java"><code class="language-java">Comparator comparator <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>Comparator<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
comparator<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token string">"nihao"</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//如果你使用了参数匹配，那么所有的参数都必须通过matchers来匹配</span>
Mockito<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>comparator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Mockito<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//下面的为无效的参数匹配使用</span>
<span class="token comment" spellcheck="true">//verify(comparator).compare(anyString(),"hello");</span></code></pre>
<h5 id="5-自定义参数匹配"><a href="#5-自定义参数匹配" class="headerlink" title="5. 自定义参数匹配"></a>5. 自定义参数匹配</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">argumentMatchersTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true">//创建mock对象</span>
   List<span class="token operator">&lt;</span>String<span class="token operator">></span> mock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true">//argThat(Matches&lt;T> matcher)方法用来应用自定义的规则，可以传入任何实现Matcher接口的实现类。</span>
   Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">argThat</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IsListofTwoElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   Assert<span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>mock<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span><span class="token string">"two"</span><span class="token punctuation">,</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">IsListofTwoElements</span> <span class="token keyword">extends</span> <span class="token class-name">ArgumentMatcher</span><span class="token operator">&lt;</span>List<span class="token operator">></span>
<span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span>Object list<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token punctuation">(</span>List<span class="token punctuation">)</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="6-预期回调接口生成期望值"><a href="#6-预期回调接口生成期望值" class="headerlink" title="6. 预期回调接口生成期望值"></a>6. 预期回调接口生成期望值</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">answerTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      List mockList <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//使用方法预期回调接口生成期望值（Answer结构）</span>
      Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mockList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"hello world:0"</span><span class="token punctuation">,</span>mockList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"hello world:999"</span><span class="token punctuation">,</span>mockList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">CustomAnswer</span> <span class="token keyword">implements</span> <span class="token class-name">Answer</span><span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> String <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
          Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">"hello world:"</span><span class="token operator">+</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
等价于：<span class="token punctuation">(</span>也可使用匿名内部类实现<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">answer_with_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">//使用Answer来生成我们我们期望的返回</span>
      Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mockList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token operator">&lt;</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@Override</span>
          <span class="token keyword">public</span> Object <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
              Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> <span class="token string">"hello world:"</span><span class="token operator">+</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"hello world:0"</span><span class="token punctuation">,</span>mockList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     Assert<span class="token punctuation">.</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"hello world:999"</span><span class="token punctuation">,</span>mockList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<h5 id="7-预期回调接口生成期望值（直接执行）"><a href="#7-预期回调接口生成期望值（直接执行）" class="headerlink" title="7. 预期回调接口生成期望值（直接执行）"></a>7. 预期回调接口生成期望值（直接执行）</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAnswer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
List<span class="token operator">&lt;</span>String<span class="token operator">></span> mock <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      Mockito<span class="token punctuation">.</span><span class="token function">doAnswer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">anyInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"大于三"</span><span class="token punctuation">,</span> mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"小于三"</span><span class="token punctuation">,</span> mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAnswer</span> <span class="token keyword">implements</span> <span class="token class-name">Answer</span><span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token punctuation">{</span>  
  <span class="token keyword">public</span> String <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>  
      Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      Integer num <span class="token operator">=</span> <span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
      <span class="token keyword">if</span><span class="token punctuation">(</span> num<span class="token operator">></span><span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>  
          <span class="token keyword">return</span> <span class="token string">"大于三"</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
          <span class="token keyword">return</span> <span class="token string">"小于三"</span><span class="token punctuation">;</span>   
      <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="8-修改对未预设的调用返回默认期望（指定返回值）"><a href="#8-修改对未预设的调用返回默认期望（指定返回值）" class="headerlink" title="8. 修改对未预设的调用返回默认期望（指定返回值）"></a>8. 修改对未预设的调用返回默认期望（指定返回值）</h5><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//mock对象使用Answer来对未预设的调用返回默认期望值</span>
List mock <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> Object <span class="token function">answer</span><span class="token punctuation">(</span>InvocationOnMock invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token number">999</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">//下面的get(1)没有预设，通常情况下会返回NULL，但是使用了Answer改变了默认期望值</span>
 Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">,</span> mock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">//下面的size()没有预设，通常情况下会返回0，但是使用了Answer改变了默认期望值</span>
 Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">,</span>mock<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h5 id="9-用spy监控真实对象-设置真实对象行为"><a href="#9-用spy监控真实对象-设置真实对象行为" class="headerlink" title="9. 用spy监控真实对象,设置真实对象行为"></a>9. 用spy监控真实对象,设置真实对象行为</h5><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>expected <span class="token operator">=</span> IndexOutOfBoundsException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">spy_on_real_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        List list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        List spy <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//下面预设的spy.get(0)会报错，因为会调用真实对象的get(0)，所以会抛出越界异常</span>
        <span class="token comment" spellcheck="true">//Mockito.when(spy.get(0)).thenReturn(3);</span>

        <span class="token comment" spellcheck="true">//使用doReturn-when可以避免when-thenReturn调用真实对象api</span>
        Mockito<span class="token punctuation">.</span><span class="token function">doReturn</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//预设size()期望值</span>
        Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>spy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//调用真实对象的api</span>
        spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        spy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span>spy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">,</span>spy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h5 id="10-不做任何返回"><a href="#10-不做任何返回" class="headerlink" title="10. 不做任何返回"></a>10. 不做任何返回</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    A a <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//void 方法才能调用doNothing()</span>
    Mockito<span class="token punctuation">.</span><span class="token function">doNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>Mockito<span class="token punctuation">.</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"bb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"bb"</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="11-调用真实的方法"><a href="#11-调用真实的方法" class="headerlink" title="11. 调用真实的方法"></a>11. 调用真实的方法</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    A a <span class="token operator">=</span> Mockito<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//void 方法才能调用doNothing()</span>
    Mockito<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"bb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"bb"</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//等价于Mockito.when(a.getName()).thenCallRealMethod();</span>
    Mockito<span class="token punctuation">.</span><span class="token function">doCallRealMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"zhangsan"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="12-重置-mock"><a href="#12-重置-mock" class="headerlink" title="12. 重置 mock"></a>12. 重置 mock</h5><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reset_mock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        List list <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mockito<span class="token punctuation">.</span> <span class="token function">when</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//重置mock，清除所有的互动和预设</span>
        Mockito<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h5 id="13-Mock-注解"><a href="#13-Mock-注解" class="headerlink" title="13. @Mock 注解"></a>13. <code>@Mock</code> 注解</h5><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockitoTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> List mockList<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//必须在基类中添加初始化mock的代码，否则报错mock的对象为NULL</span>
    <span class="token keyword">public</span> <span class="token function">MockitoTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        MockitoAnnotations<span class="token punctuation">.</span><span class="token function">initMocks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">AnnoTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mockList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mockito<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>mockList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h5 id="14-指定测试类使用运行器：MockitoJUnitRunner"><a href="#14-指定测试类使用运行器：MockitoJUnitRunner" class="headerlink" title="14. 指定测试类使用运行器：MockitoJUnitRunner"></a>14. 指定测试类使用运行器：MockitoJUnitRunner</h5><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>MockitoJUnitRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockitoTest2</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> List mockList<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shorthand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        mockList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mockito<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>mockList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="2-3-6-MockBean"><a href="#2-3-6-MockBean" class="headerlink" title="2.3.6-@MockBean"></a>2.3.6-<code>@MockBean</code></h4><p>使用 <code>@MockBean</code> 可以解决单元测试中的一些依赖问题，示例如下：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceWithMockBeanTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@MockBean</span>
    SampleDependencyA dependencyA<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    SampleService sampleService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDependency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">when</span><span class="token punctuation">(</span>dependencyA<span class="token punctuation">.</span><span class="token function">getExternalValue</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">"mock val: A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"mock val: A"</span><span class="token punctuation">,</span> sampleService<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code>@MockBean</code> 只能 mock 本地的代码——或者说是自己写的代码，对于储存在库中而且又是以 Bean 的形式装配到代码中的类无能为力。</p>
<p><code>@SpyBean</code> 解决了 SpringBoot 的单元测试中 <code>@MockBean</code> 不能 mock 库中自动装配的 Bean 的局限</p>
<p>参考自：</p>
<p><a href="https://www.jianshu.com/p/ecbd7b5a2021" target="_blank" rel="noopener">https://www.jianshu.com/p/ecbd7b5a2021</a></p>
<p><a href="https://www.imooc.com/article/292626" target="_blank" rel="noopener">https://www.imooc.com/article/292626</a></p>
<h4 id="2-3-7-在项目中使用Mockito"><a href="#2-3-7-在项目中使用Mockito" class="headerlink" title="2.3.7-在项目中使用Mockito"></a>2.3.7-在项目中使用Mockito</h4><ul>
<li><p><strong>创建一个service</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WebService</span> <span class="token punctuation">{</span>

    String <span class="token function">web</span><span class="token punctuation">(</span>String string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">WebService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> String <span class="token function">web</span><span class="token punctuation">(</span>String string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"WebServiceImpl 运行成功"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p><strong>创建Controller</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/web"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> WebService webService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/create"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> WebResponse<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> WebRequest webRequest<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">//调用service</span>
        String str <span class="token operator">=</span> webService<span class="token punctuation">.</span><span class="token function">web</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        WebResponse<span class="token operator">&lt;</span>String<span class="token operator">></span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebResponse</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"00000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p><strong>创建测试用例</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebControllerIT</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> WebApplicationContext mac<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> MockMvc mockMvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> WebService webService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        <span class="token function">doReturn</span><span class="token punctuation">(</span><span class="token string">"Mockito WebServiceImpl 运行完成"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>webService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">web</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//请求的json</span>
        String json <span class="token operator">=</span> <span class="token string">"{\"name\":\"王五\",\"mobile\":\"12345678901\"}"</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//perform,执行一个RequestBuilders请求，会自动执行SpringMVC的流程并映射到相应的控制器执行处理</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>MockMvcRequestBuilders
                <span class="token comment" spellcheck="true">//构造一个post请求</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/web/create"</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//json类型</span>
                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span>APPLICATION_JSON_UTF8<span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//使用writeValueAsString()方法来获取对象的JSON字符串表示</span>
                <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//andExpect，添加ResultMathcers验证规则，验证控制器执行完成后结果是否正确，【这是一个断言】</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//使用jsonPaht验证返回的json中code字段的返回值</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.code"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"00000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.message"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//body属性不为空</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>MockMvcResultMatchers<span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//添加ResultHandler结果处理器，比如调试时 打印结果(print方法)到控制台</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span>MockMvcResultHandlers<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">//返回相应的MvcResult</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>从上面的代码可以看到，我们新增了一个<code>webService</code>，并增加了<code>@MockBean</code>注解，表示将<code>webService</code>给mock调，这样我们就可以增加自己想要得<code>webService</code>返回结果。<br>在测试用例中我们增加了<code>doReturn()</code>方法，这段代码的含义是当调用<code>WebService</code>中的<code>web()</code>方法时（<code>anyString()</code>表示传入<code>web()</code>方法中的参数是任意的String类型，当然还有个<code>anyInt()</code>等方法），返回<code>Mockito WebServiceImpl 运行完成</code>。当然你也可以不将<code>WebService</code>给mock掉，这样拿到的就是正常的返回值。</p>
</li>
</ul>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://fangpeng12.github.io" rel="external nofollow noreferrer">fangpeng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://fangpeng12.github.io/2020/02/21/dan-yuan-ce-shi-zhi-mock/">https://fangpeng12.github.io/2020/02/21/dan-yuan-ce-shi-zhi-mock/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://fangpeng12.github.io" target="_blank">fangpeng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">
                                    <span class="chip bg-color">单元测试</span>
                                </a>
                            
                                <a href="/tags/Mock/">
                                    <span class="chip bg-color">Mock</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2020/02/21/dan-yuan-ce-shi-zhi-mock/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="单元测试之Mock">
                        
                        <span class="card-title">单元测试之Mock</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Mock的使用和详解
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-category">
                                    单元测试
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">
                        <span class="chip bg-color">单元测试</span>
                    </a>
                    
                    <a href="/tags/Mock/">
                        <span class="chip bg-color">Mock</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/02/15/a-li-ba-ba-java-kai-fa-shou-ce-xiang-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="《阿里巴巴Java开发手册》详解">
                        
                        <span class="card-title">《阿里巴巴Java开发手册》详解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            阿里巴巴java开发手册详解
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Java/" class="post-category">
                                    Java
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/">
                        <span class="chip bg-color">开发手册</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">年份</span>
            <a href="https://fangpeng12.github.io" target="_blank">fangpeng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">368.8k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    window.setTimeout("siteTime()", 1000);
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "12";
                    var startDate = "21";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/fangpeng12" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>















    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
